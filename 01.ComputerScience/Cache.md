# 캐시 Cache
캐시는 데이터 값을 미리 복사해 놓는 임시 장소를 가리킨다. 캐시의 접근 시간은 원래 데이터에 접근하는 시간보다 빠르기 때문에, 연산 시간을 줄이고 시스템 효율성을 증가시킨다.

## 캐시의 지역성
캐시가 효율적으로 동작하려면 캐시 메모리의 성능 즉, 캐시의 적중률을 극대화 시켜야 한다. 때문에 캐시는 CPU가 어떤 데이터를 원할 것인가를 어느 정도 예측해야 한다. 이를 위해 데이터 지역성을 활용한다. 이는 프로그램은 어느 한 순간에 모든 코드나 데이터를 균등하게 접근하지 않는다는 특성을 기본으로 한다. 지역성은 두 가지로 나눌 수 있는데, 시간적 지역성과 공간적 지역성이다.
- 시간적 지역성 : 특정 데이터가 한 번 접근되었을 경우, 가까운 미래에 또 한 번 해당 데이터에 접근할 가능성이 높은 것을 말한다. 반복문나 공통 변수 등을 들 수 있다.
- 공간적 지역성 : 특정 데이터와 가까운 메모리에 적재된 데이터를 사용할 가능성이 높은 것을 말한다. 이때문에 CPU 캐시나 디스크 캐시의 경우, 메모리에 접근할 때 특정 주소 뿐 아니라 해당 블록 전체를 캐시에 가져오게 한다. 순차적 명령어 실행이나 배열 등을 예로 들 수 있다.
<br><br>
여기서는 캐시를 **데이터 값을 미리 복사해두는 임시 장소**로 생각하고 같은 역할을 하는 캐시 테이블을 모두 알아본다.
# 캐시의 종류
## HARDWARE
### CPU Cache
대용량의 메인 메모리 접근을 빠르게 하기 위해 CPU 칩 내부나 바로 옆에 탑재하는 작은 메모리이다. <strong>CPU 코어</strong>(고속)와 <strong>메모리</strong>(RAM을 말함, CPU에 비해 저속) 사이 속도 차에 따른 병목 현상을 완화하는 역할을 한다. CPU가 메모리에 저장된 데이터를 읽으면서 자주 사용하는 데이터를 캐시 메모리에 저장하고, 다시 사용할 때에는 캐시 메모리에서 가져오게 한다. <br>
CPU에는 이러한 캐시 메모리가 2~3개 정도 쓰이는데 L1, L2, L3로 구분할 수 있다. 이는 속도와 크기에 따라 분류한 것으로, L1 -> L2 -> L3 순으로 데이터를 찾아본다. L3에서도 데이터를 찾지 못하면 메인 메모리로 넘어가서 데이터를 찾는다. <br>
L1은 가장 작은 용량으로 CPU가 가장 빠르게 찾아볼 수 있는 캐시이다. L2는 용량은 L1보다 크고, 속도는 조금 느리다. L3 역시 L2보다 용량이 크고 속도가 느리다.

### 디스크 캐시
디스크 버퍼라고도 불린다. <strong>주 기억장치</strong>(RAM)와 <strong>보조 기억장치</strong>(하드 디스크) 사이에 존재하는 캐시이다. 프로그램을 실행할 때, 메모리에는 해당 프로세스의 모든 데이터와 명령어를 메모리에 적재하지 않는다. 필요한 부분만 올려놓고 사용하는데, 이 때 효율을 높이기 위해 사용하는 것이 디스크 캐시이다. 디스크에 저장된 데이터에 접근하는 속도가 (비교적) 매우 느리기 때문에 사용한다.<br><br>
디스크 캐시는 가상 메모리와 밀접한 연관이 있다. 가상 메모리의 안정성, 디스크 캐시의 성능을 통해 윈도우 성능을 최적화시킬 수 있다.<br>

- 미리 읽기 : OS에서 디스크에 I/O를 요청할 때 디스크 암은 헤드를 해당하는 트랙에 올려놓은 뒤 일정 시간이 걸려야 비로소 데이터를 읽을 수 있다. 그러나 OS는 대부분은 연이은 데이터까지 요구하는 경우가 많기 때문에 뒷부분 데이터도 미리 읽어서 캐시에 저장한다.
- 속도 조절 : 디스크의 입출력 인터페이스는 디스크 플래터가 데이터를 읽어들이는 속도에 비해 훨씬 느리다. 그러므로 디스크 암이 빠르게 읽고 쓰기를 수행하기 위해 데이터를 인터페이스에 넘기기 전에 캐시에 잠시 저장해놓는다.
- 쓰기 가속 : OS가 디스크에 쓰기를 요청했을 때, 디스크 암이 쓰기를 마치지 않더라고 캐시에 적재되었다면 쓰기가 끝났다고 보고할 수 있다. 이를 통해 OS는 디스크의 입력 시간을 기다리지 않고 다음 작업으로 넘어갈 수 있다. 단, 쓰기가 끝나기 전 전원이 꺼지는 등 불상사가 생긴다면 데이터가 날아가기 때문에 논쟁의 대상이다.
- 명령 큐 : 다른 명령을 수행하는 중에도 다른 명령을 추가로 받아 디스크 캐시에 저장된다. 명령 큐는 쓰기가 완전히 끝났을 때에 OS에 그 사실을 알린다.

### TLB
변환 색인 버퍼(Translation Lookaside Buffer)로, 주소 변환 캐시라고도 불린다. 가상 메모리 주소와 물리적 메모리 주소의 맵핑 테이블을 저장한다. CPU는 1차적으로 TLB에 접근해서 원하는 페이지가 존재하는지 탐색하고, TLB에 존재하지 않는 경우 MMU의 페이지 테이블을 참조한다.<br>
TLB에서 물리적 주소를 찾아오면, 그 주소를 CPU Cache에서 찾아본다. 만일 없다면 Memory(RAM)에서 찾아온다.

## NETWORK
### DNS Cache
컴퓨터 OS에서 유지 관리하는 임시 DB로, 최근 방문수, 웹사이트 및 기타 인터넷 도메인 방문 시도를 모두 기록한다. 즉, 웹 사이트를 로드할 때 도메인에 따른 IP 주소를 빠르게 참조할 수 있도록 도메인과 IP 주소를 맵핑해놓은 캐시이다. <br>
사용자가 도메인을 입력하면 OS는 가장 먼저 hosts 파일을 확인하고, 찾을 수 없으면 DNS 캐시 테이블을 확인한다. 여기서도 찾을 수 없다면 로컬 DNS 서버 IP 주소로 도메인 네임에 대한 질의를 요청한다. <br>
단 이 캐시는 영구한 것이 아니라 TTL이 0이 되면 사라진다. 이를 악용하여 DNS Cache Poisoning 공격을 받을 수 있다.

### ARP Cache
ARP 요청을 통해 얻은 특정 IP 주소에 대한 MAC 주소를 저장해놓는 캐시 테이블이다. IP주소를 통해 MAC주소를 검색할 때 가장 먼저 ARP 캐시 테이블을 확인하고, 캐시 테이블에 없는 경우에 ARP 요청을 브로드캐스트로 보낸다. 캐시 테이블에 주소가 존재한다면 브로드캐스트를 보낼 필요가 없기 때문에 네트워크의 부하가 적어지고 성능이 향상된다.<br>
ARP 캐시 역시 일정 시간동안 저장하고 삭제하는데, 이는 IP 주소가 바뀔 수도 있기 때문이다. 이 때문에 적정 시간을 찾아 설정하는 것이 중요하다. 너무 짧으면 브로드캐스트 양이 많아져 네트워크 성능이 떨어지고, 너무 길면 정확한 IP를 얻지 못할 수 있기 때문이다.

### Web Cache (HTTP Cache)
서버 지연을 줄이기 위해 웹 페이지, 이미지, 기타 유형의 웹 멀티미디어 등의 웹 문서들을 임시 저장하기 위한 기술이다. 웹 캐시 시스템은 이를 통과하는 문서들의 사본을 저장하며, 이후 요청들은 특정 조건을 충족하는 경우 캐시화가 가능하다.<br>
client가 요청하는 html, image, js, css 등에 대해, 첫 요청 시 파일을 내려받아 복사본을 저장하고, 이후 동일한 URL의 요청은 내부에 저장한 파일을 사용하여 더 빠르게 서비스한다. 서버와의 요청-응답이 줄이들기 때문에 응답시간이 감소하고 네트워크 트레픽이 감소한다.
- Browser Cache : 브라우저, 또는 HTTP 요청을 하는 client Application에 의해 내부 디스크에 캐시가 저장된다. 브라우저의 back 버튼, 또는 이미 방문한 페이지를 재방문하는 경우 극대화된다. 인터넷 연결이 끊긴 상황에서 뒤로가기 버튼을 눌렀을 때에도 페이지가 로드되는 경우가 이에 해당한다.
- Proxy Cache : Browser와 동일한 원리지만 네트워크 상에서 동작한다. 규모가 큰 회사나 IPS의 방화벽에 설치되며 대기시간과 트래픽이 감소한다. 한정된 수의 클라이언트를 위해 무한대의 웹 서버의 컨텐츠를 캐시 저장한다.
- Gateway Cache : 서버 앞 단에 설치되어 요청에 대한 캐시 및 효율적인 분배를 통해 가용성, 신뢰성, 성능등을 향상 시킨다. 암호화, SSL acceleration, 로드 밸런싱, 압축 등을 수행한다. 무한대의 client에게 한정된 수의 웹서버 컨텐츠를 제공한다.
